/* 
Модуль содержит функции selectors:

Отрисовка всех телефонов и поиск,
Отрисовка телефона по ID,
Вычисление колличества товаров в корзине,
Вычисление стоимости товаров в корзине,
Показывает колличество товаров уже отрисованых на старнице (Load More)

*/

import R from 'ramda'

// Поиск телефона по ID, возвращает объект по ID или null
export const getPhoneById = (state, id) => R.prop(id, state.phones)

 // Все телефоны и поиск - Search
export const getPhones = state => {
    
    // функция applySearch, которая будет просто фильтровать полученные телефоны по имени
    
     const applySearch = item => R.compose(
         // Содержит ли поле search маленькими буквами
    R.contains(R.toLower(state.phonesPage.search)), // по умолчанию строка фильтра contains всегда пустая
    // маленькими буквами
    R.toLower,
    R.prop('name') // поле name
  )(item)
      
      // Оборачиваем старую функцию в compose
      const phones = R.compose(
        // Применяем фильтрацию
        R.filter(applySearch),   
        //Мапим  ids, чтобы найти все нужные телефоны
        R.map(id => getPhoneById(state, id))
        // выносим state.phonesPage.ids в отдельные скобки - синтаксис R.compose
      )(state.phonesPage.ids)
    
      return phones  
    
}

/*
// OLD method *** Запрос всех телефонов
export const getPhones = state => {  
    // Мапим  ids, чтобы найти все нужные телефоны
    const phones = R.map(id => getPhoneById(state, id), state.phonesPage.ids)
    return phones
  }
*/

// Показывает колличество товаров уже отрисованых на старнице (Load More)
// R.length возвращает длину массива
export const getRenderedPhonesLength = state => R.length(state.phonesPage.ids)


// Методы корзины

// Подсчет колличества товаров в корзине
export const getTotalBasketCount = state => R.length(state.basket)

// Подсчет общей цены товаров в корзине, просто считаем длинну массива корзины

export const getTotalBasketPrice = state => {
       // Compose работает справа на лево, берем из корзины все телефоны по idшникам.
    // Берем из каждого обьекта только цену и потом суммируем ее с помощью метода sum.
    const totalPrice = R.compose(
      R.sum,
      R.pluck('price'),
      R.map(id => getPhoneById(state, id))// Используем ранее созданный метод getPhoneById
    )(state.basket)
  
    return totalPrice
  }
  